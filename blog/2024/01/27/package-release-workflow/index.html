<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Choreographing a release process for my PyPI packages | Pradyun Gedam</title>
<meta name=keywords content="Python Packaging"><meta name=description content="I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.
This is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself."><meta name=author content><link rel=canonical href=https://pradyunsg.me/blog/2024/01/27/package-release-workflow/><link crossorigin=anonymous href=/assets/css/stylesheet.7b8fc114e1f19fb88dace69824bcba608a1c838fd9379276cac5b3a8db384766.css integrity="sha256-e4/BFOHxn7iNrOaYJLy6YIocg4/ZN5J2ysWzqNs4R2Y=" rel="preload stylesheet" as=style><link rel=icon href=https://pradyunsg.me/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://pradyunsg.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://pradyunsg.me/favicon-32x32.png><link rel=apple-touch-icon href=https://pradyunsg.me/apple-touch-icon.png><link rel=mask-icon href=https://pradyunsg.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Choreographing a release process for my PyPI packages"><meta property="og:description" content="I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.
This is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself."><meta property="og:type" content="article"><meta property="og:url" content="https://pradyunsg.me/blog/2024/01/27/package-release-workflow/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-01-27T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Choreographing a release process for my PyPI packages"><meta name=twitter:description content="I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.
This is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Scribbled Notes","item":"https://pradyunsg.me/blog/"},{"@type":"ListItem","position":2,"name":"Choreographing a release process for my PyPI packages","item":"https://pradyunsg.me/blog/2024/01/27/package-release-workflow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Choreographing a release process for my PyPI packages","name":"Choreographing a release process for my PyPI packages","description":"I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.\nThis is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself.","keywords":["Python Packaging"],"articleBody":"I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.\nThis is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself. I’m posting this publicly so that I can get feedback from a few people I know about this and whether they think it makes sense.\nNone of this is related to the whole “what build-backend/environment management/script runner tool should I use” situation but rather it’s everything “around” that. I’m not going into the test running or documentation building aspects here, “just” the mechanics around making a package release.\nMy design goals This is basically “what I want” in terms of using existing communication channels, ensuring consistency and the development workflow.\nHave the version number managed as-is in the source tree. Have the version number be {last_release+1}.dev{N} during development. Have a git tag pointing to the commit with a release’s code. Have a changelog auto-generated based on the Git history or source tree. Include the changelog in the documentation at the release tag. Publish to pypi.org via Trusted Publishers, triggered automatically but requiring manual approval1. Publish a GitHub release. Include the changelog in the GitHub release description. Include the release files on the GitHub release. The git tag and GitHub release must not be published if the release cannot be uploaded to PyPI. Releasing to PyPI requires a manual approval even after PR merge. What those design goals imply changelog: needs to be maintained in Markdown, specifically the intersection of GFM and MyST. needs to be generated before making the commit that the release would be tagged on, since the documentation within the release should contain the generated changelog. needs to only describe what happened between this release and the last one (so that it makes sense in the GitHub releases UI). PyPI release: needs to happen on GitHub Actions, and the release needs to be triggered by a git tag (with protection rules on git tags). needs to also upload the files to GitHub release. version number: need a figure out the logic for bumping to next development version. need some way to detect when a PR changes the version number and determine the commit that should trigger a release. Let’s figure out the details now The specific flow that seems to be needed here is:\nMerge a PR that bumps the release version. The merge will trigger a “release” workflow that has the ability to push a commit (containing the changelog) and trigger a different “publish” workflow. The triggered “publish” workflow needs approval to run and has the ability to publish to PyPI, push a git tag, publish a GitHub release and include the description as well as release files2. Changelog is not the same everywhere Well, the changelog in documentation needs to do some things that the GitHub UI would do for “free”: have a link to the original diff between releases and a link to individual PRs in changelog entries.\nAdditionally, the changelog in documentation should also have a preview when looking at “latest” documentation, to communicate how things would work.\nDeciding on how to detect version number changes There’s basically 2 options here:\nTry to look at the source of truth that lives in the source code (like src/package/__init__.py -\u003e __version__ / pyproject.toml -\u003e project.version). Look at the relevant PR and bump the version based on some immutable thing about the PR. I think the first is a better experience, since it’s a bit more intuitive – the version number changed and a release was automatically made. With this, an obvious place to make the release tag would be the “first” commit that bumps the version, which would need to vary based on merge strategy…\nmerge commit: Use the merge commit into main, that has the multiple parents. squash merges: Use the first commit that bumps the version. rebase merges: Use the first commit that bumps the version… but wait… Oh heck, rebase merges Ohk, let’s think through this. I have a PR that contains 3 commits:\n3pstrel Awesome change after the version bump 2verbmp Version bump 1prerel Awesome change before the version bump 0staquo (main) Status quo Assuming that this is rebase-merged, I think the release commit should be based on top of 2verbmp. But, the only way to have it make sense with 3pstrel is to have the release commit be based on 2verbmp and then later to do a merge commit – which defeats the point of rebase merges (linear history).\nI guess there’s 2 options here:\nDetect such cases and error out. Don’t bother merging back the release tag commit. If we don’t merge back the release tag commit, then the release process needs to not require any code change other than the version bump. The changelog needs to be managed out-of-tree somehow (eg: in git?). I like having the ability to update a changelog entry that was contributed by a fly-by contributor after the PR has been merged, so this is a no-go for me.\nIn terms of detecting such cases, I guess I could have a GitHub Actions check that there isn’t a commit in the PR after one that bumps the version.\nLooking at the source of truth Doing a quick search on the internet for how to find when a line has changed with git, I found a useful StackOverflow question which points me to git log -L :. Trying it out on pip tells me this is a good option:\n❯ git ls -L 3,3:src/pip/__init__.py -q c0cce3ca6 Bump for development [Stéphane Bidoul] e3dc91dad (tag: 23.3) Bump for release [Stéphane Bidoul] b6a267059 Bump for development [Paul Moore] a3c2c43c5 (tag: 23.2) Bump for release [Paul Moore] 2fd3e408d Bump for development [Paul Moore] 6424ac460 (tag: 23.1) Bump for release [Paul Moore] d21af1c98 Bump for development [Pradyun Gedam] 368c7b4c5 (tag: 23.0) Bump for release [Pradyun Gedam] c8ae28001 Bump for development [Paul Moore] 0a76da3a9 (tag: 22.3) Bump for release [Paul Moore] 2132eb4cd Bump for development [Stéphane Bidoul] 8e7e76e60 (tag: 22.2) Bump for release [Stéphane Bidoul] 88d565cc3 Bump for development [Pradyun Gedam] 3c953322c (tag: 22.1) Bump for release [Pradyun Gedam] 6012b48e5 Bump for development [Pradyun Gedam] 9b203d5af (tag: 22.1b1) Bump for release [Pradyun Gedam] 0a916125e Bump for development [Pradyun Gedam] 1742af7bd (tag: 22.0) Bump for release [Pradyun Gedam] 2bf32f5f9 Bump for development [Pradyun Gedam] abec8a701 (tag: 21.3) Bump for release [Pradyun Gedam] [...] And, that the existing automation around pip releases is quite nice.\nI still need to figure out how to gracefully handle changes to the source of truth for versions as well as moving it around without logical changes (eg: editing the docstring, or changing quoting etc).\nOh, this reminded me about pip’s releases…\nLet’s think about pip I’m not the only one who makes the calls on this but I think it would be nice to move pip to Trusted Publishers for publishing releases. Looking at the documented pip process, the main things that’d need to different if it adopted this release process would be:\nUpdate get-pip.py’s GitHub repository to reflect the new pip release on PyPI. Update an AUTHORS file. Those don’t seem particularly bad. For 1, we’d need to tweak the generation logic over on get-pip.py to listen for repository_dispatch and trigger that event manually with the relevant payload and that’ll need pypa/pip to store an access token to pypa/get-pip that is only exposed for that specific trigger, which… seems doable.\nWhat needs to be created? 3 GitHub Actions reusable workflows for individual “tasks” A “release” workflow that determines if a release needs to be made and triggers the “publish” workflow via a workflow_dispatch. A “publish” workflow that does all the mechanics of making the release. A “release-check” workflow that checks the commit situation to protect against “commit after version bump” edge cases. 1 GitHub Actions reusable workflow for consolidated handling in project CI, to enable the project’s release.yml to be a short file that’s “just” on: [...] and uses: [...]. Naming: The second hardest problem in computer science I feel like I should come up with a name for this, because it’d make communicating about this easier for me and because this workflow feels like it would be useful to more than just me.\nThis is automation that makes a release when it detects by a version change in source code and publishes to PyPI and GitHub, with an auto-generated changelog.\nFor now, this is a problem for future me and depends on whether he decides that he needs to maintain another piece of reusable software.\nWith a few too many “critical” (i.e. top 1% packages) on PyPI, including literally pip, I think an extra step to ensure that it’s a bit harder to take-over things unilaterally seems reasonable to me. ↩︎\nIf you’re an SBOM/SLSA person, this is also where I’d like to include some sort of attestation/provenance information but there isn’t any clear-enough documentation that I could find for how to do this. Please email me if you know of a solution (mail@{this domain}). ↩︎\n","wordCount":"1547","inLanguage":"en","datePublished":"2024-01-27T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://pradyunsg.me/blog/2024/01/27/package-release-workflow/"},"publisher":{"@type":"Organization","name":"Pradyun Gedam","logo":{"@type":"ImageObject","url":"https://pradyunsg.me/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pradyunsg.me/ accesskey=h title="Pradyun Gedam (Alt + H)">Pradyun Gedam</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pradyunsg.me/about/ title=about><span>about</span></a></li><li><a href=https://pradyunsg.me/blog/ title=Blog><span>blog</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Choreographing a release process for my PyPI packages</h1><div class=post-meta>January 27, 2024&nbsp;·&nbsp;8 minutes</div></header><div class=post-content><p>I maintain quite a few Python packages and they all have development workflows as well as release processes that are different in various ways.</p><p>This is basically my research document as I am exploring what I want the release process (and supporting development workflow) to look like for the Python packages I maintain, so that I can reduce the overhead caused by the various differences in these projects as well as the need to make all these decisions myself. I&rsquo;m posting this publicly so that I can get feedback from a few people I know about this and whether they think it makes sense.</p><p>None of this is related to the whole &ldquo;what build-backend/environment management/script runner tool should I use&rdquo; situation but rather it&rsquo;s everything &ldquo;around&rdquo; that. I&rsquo;m not going into the test running or documentation building aspects here, &ldquo;just&rdquo; the mechanics around making a package release.</p><h2 id=my-design-goals>My design goals<a hidden class=anchor aria-hidden=true href=#my-design-goals>#</a></h2><p>This is basically &ldquo;what I want&rdquo; in terms of using existing communication channels, ensuring consistency and the development workflow.</p><ul><li>Have the version number managed as-is in the source tree.</li><li>Have the version number be <code>{last_release+1}.dev{N}</code> during development.</li><li>Have a git tag pointing to the commit with a release&rsquo;s code.</li><li>Have a changelog auto-generated based on the Git history or source tree.</li><li>Include the changelog in the documentation at the release tag.</li><li>Publish to pypi.org via Trusted Publishers, triggered automatically but requiring manual approval<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</li><li>Publish a GitHub release.<ul><li>Include the changelog in the GitHub release description.</li><li>Include the release files on the GitHub release.</li></ul></li><li>The git tag and GitHub release must not be published if the release cannot be uploaded to PyPI.</li><li>Releasing to PyPI requires a manual approval even after PR merge.</li></ul><h2 id=what-those-design-goals-imply>What those design goals imply<a hidden class=anchor aria-hidden=true href=#what-those-design-goals-imply>#</a></h2><ul><li>changelog:<ul><li>needs to be maintained in Markdown, specifically the intersection of <a href=https://github.github.com/gfm/>GFM</a> and <a href=https://myst-parser.readthedocs.io/en/latest/>MyST</a>.</li><li>needs to be generated <em>before</em> making the commit that the release would be tagged on, since the documentation within the release should contain the generated changelog.</li><li>needs to only describe what happened between this release and the last one (so that it makes sense in the GitHub releases UI).</li></ul></li><li>PyPI release:<ul><li>needs to happen on GitHub Actions, and the release needs to be triggered by a git tag (with protection rules on git tags).</li><li>needs to also upload the files to GitHub release.</li></ul></li><li>version number:<ul><li>need a figure out the logic for bumping to next development version.</li><li>need some way to detect when a PR changes the version number and determine the commit that should trigger a release.</li></ul></li></ul><h2 id=lets-figure-out-the-details-now>Let&rsquo;s figure out the details now<a hidden class=anchor aria-hidden=true href=#lets-figure-out-the-details-now>#</a></h2><p>The specific flow that seems to be needed here is:</p><ul><li>Merge a PR that bumps the release version.</li><li>The merge will trigger a &ldquo;release&rdquo; workflow that has the ability to push a commit (containing the changelog) and trigger a different &ldquo;publish&rdquo; workflow.</li><li>The triggered &ldquo;publish&rdquo; workflow needs approval to run and has the ability to publish to PyPI, push a git tag, publish a GitHub release and include the description as well as release files<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</li></ul><h3 id=changelog-is-not-the-same-everywhere>Changelog is not the same everywhere<a hidden class=anchor aria-hidden=true href=#changelog-is-not-the-same-everywhere>#</a></h3><p>Well, the changelog in documentation needs to do some things that the GitHub UI would do for &ldquo;free&rdquo;: have a link to the original diff between releases and a link to individual PRs in changelog entries.</p><p>Additionally, the changelog in documentation should also have a preview when looking at &ldquo;latest&rdquo; documentation, to communicate how things would work.</p><h3 id=deciding-on-how-to-detect-version-number-changes>Deciding on how to detect version number changes<a hidden class=anchor aria-hidden=true href=#deciding-on-how-to-detect-version-number-changes>#</a></h3><p>There&rsquo;s basically 2 options here:</p><ul><li>Try to look at the source of truth that lives in the source code (like <code>src/package/__init__.py -> __version__</code> / <code>pyproject.toml -> project.version</code>).</li><li>Look at the relevant PR and bump the version based on some immutable thing about the PR.</li></ul><p>I think the first is a better experience, since it&rsquo;s a bit more intuitive &ndash; the version number changed and a release was automatically made. With this, an obvious place to make the release tag would be the &ldquo;first&rdquo; commit that bumps the version, which would need to vary based on merge strategy&mldr;</p><ul><li>merge commit: Use the merge commit into <code>main</code>, that has the multiple parents.</li><li>squash merges: Use the first commit that bumps the version.</li><li>rebase merges: Use the first commit that bumps the version&mldr; but wait&mldr;</li></ul><h4 id=oh-heck-rebase-merges>Oh heck, rebase merges<a hidden class=anchor aria-hidden=true href=#oh-heck-rebase-merges>#</a></h4><p>Ohk, let&rsquo;s think through this. I have a PR that contains 3 commits:</p><ul><li><code>3pstrel</code> Awesome change after the version bump</li><li><code>2verbmp</code> Version bump</li><li><code>1prerel</code> Awesome change before the version bump</li><li><code>0staquo</code> (main) Status quo</li></ul><p>Assuming that this is rebase-merged, I <em>think</em> the release commit should be based on top of <code>2verbmp</code>. But, the only way to have it make sense with <code>3pstrel</code> is to have the release commit be based on <code>2verbmp</code> and then later to do a merge commit &ndash; which defeats the point of rebase merges (linear history).</p><p>I guess there&rsquo;s 2 options here:</p><ul><li>Detect such cases and error out.</li><li>Don&rsquo;t bother merging back the release tag commit.</li></ul><p>If we don&rsquo;t merge back the release tag commit, then the release process needs to not require <em>any</em> code change other than the version bump. The changelog needs to be managed out-of-tree somehow (eg: in git?). I like having the ability to update a changelog entry that was contributed by a fly-by contributor after the PR has been merged, so this is a no-go for me.</p><p>In terms of detecting such cases, I guess I could have a GitHub Actions check that there isn&rsquo;t a commit in the PR after one that bumps the version.</p><h4 id=looking-at-the-source-of-truth>Looking at the source of truth<a hidden class=anchor aria-hidden=true href=#looking-at-the-source-of-truth>#</a></h4><p>Doing a quick search on the internet for how to find when a line has changed with git, I found <a href=https://stackoverflow.com/questions/13692072/git-blame-committed-line>a useful StackOverflow question</a> which points me to <code>git log -L &lt;range>:&lt;file></code>. Trying it out on pip tells me this is a good option:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh-session data-lang=sh-session><span style=display:flex><span>❯ git ls -L 3,3:src/pip/__init__.py -q
</span></span><span style=display:flex><span>c0cce3ca6 Bump for development [Stéphane Bidoul]
</span></span><span style=display:flex><span>e3dc91dad (tag: 23.3) Bump for release [Stéphane Bidoul]
</span></span><span style=display:flex><span>b6a267059 Bump for development [Paul Moore]
</span></span><span style=display:flex><span>a3c2c43c5 (tag: 23.2) Bump for release [Paul Moore]
</span></span><span style=display:flex><span>2fd3e408d Bump for development [Paul Moore]
</span></span><span style=display:flex><span>6424ac460 (tag: 23.1) Bump for release [Paul Moore]
</span></span><span style=display:flex><span>d21af1c98 Bump for development [Pradyun Gedam]
</span></span><span style=display:flex><span>368c7b4c5 (tag: 23.0) Bump for release [Pradyun Gedam]
</span></span><span style=display:flex><span>c8ae28001 Bump for development [Paul Moore]
</span></span><span style=display:flex><span>0a76da3a9 (tag: 22.3) Bump for release [Paul Moore]
</span></span><span style=display:flex><span>2132eb4cd Bump for development [Stéphane Bidoul]
</span></span><span style=display:flex><span>8e7e76e60 (tag: 22.2) Bump for release [Stéphane Bidoul]
</span></span><span style=display:flex><span>88d565cc3 Bump for development [Pradyun Gedam]
</span></span><span style=display:flex><span>3c953322c (tag: 22.1) Bump for release [Pradyun Gedam]
</span></span><span style=display:flex><span>6012b48e5 Bump for development [Pradyun Gedam]
</span></span><span style=display:flex><span>9b203d5af (tag: 22.1b1) Bump for release [Pradyun Gedam]
</span></span><span style=display:flex><span>0a916125e Bump for development [Pradyun Gedam]
</span></span><span style=display:flex><span>1742af7bd (tag: 22.0) Bump for release [Pradyun Gedam]
</span></span><span style=display:flex><span>2bf32f5f9 Bump for development [Pradyun Gedam]
</span></span><span style=display:flex><span>abec8a701 (tag: 21.3) Bump for release [Pradyun Gedam]
</span></span><span style=display:flex><span>[...]
</span></span></code></pre></div><p>And, that the existing automation around pip releases is quite nice.</p><p>I still need to figure out how to gracefully handle changes to the source of truth for versions as well as moving it around without logical changes (eg: editing the docstring, or changing quoting etc).</p><p>Oh, this reminded me about pip&rsquo;s releases&mldr;</p><h3 id=lets-think-about-pip>Let&rsquo;s think about pip<a hidden class=anchor aria-hidden=true href=#lets-think-about-pip>#</a></h3><p>I&rsquo;m not the only one who makes the calls on this but I think it would be nice to move pip to Trusted Publishers for publishing releases. Looking at the documented pip process, the main things that&rsquo;d <strong>need</strong> to different if it adopted this release process would be:</p><ol><li>Update <code>get-pip.py</code>&rsquo;s GitHub repository to reflect the new pip release on PyPI.</li><li>Update an AUTHORS file.</li></ol><p>Those don&rsquo;t seem particularly bad. For 1, we&rsquo;d need to tweak the generation logic over on <code>get-pip.py</code> to listen for <code>repository_dispatch</code> and <a href="https://docs.github.com/en/rest/repos/repos?apiVersion=2022-11-28#create-a-repository-dispatch-event">trigger that event</a> manually with the relevant payload and that&rsquo;ll need <code>pypa/pip</code> to store an access token to <code>pypa/get-pip</code> that is only exposed for that specific trigger, which&mldr; seems doable.</p><h2 id=what-needs-to-be-created>What needs to be created?<a hidden class=anchor aria-hidden=true href=#what-needs-to-be-created>#</a></h2><ul><li>3 GitHub Actions reusable workflows for individual &ldquo;tasks&rdquo;<ul><li>A &ldquo;release&rdquo; workflow that determines if a release needs to be made and triggers the &ldquo;publish&rdquo; workflow via a <code>workflow_dispatch</code>.</li><li>A &ldquo;publish&rdquo; workflow that does all the mechanics of making the release.</li><li>A &ldquo;release-check&rdquo; workflow that checks the commit situation to protect against &ldquo;commit after version bump&rdquo; edge cases.</li></ul></li><li>1 GitHub Actions reusable workflow for consolidated handling in project CI, to enable the project&rsquo;s <code>release.yml</code> to be a short file that&rsquo;s &ldquo;just&rdquo; <code>on: [...]</code> and <code>uses: [...]</code>.</li></ul><h2 id=naming-the-second-hardest-problem-in-computer-science>Naming: The second hardest problem in computer science<a hidden class=anchor aria-hidden=true href=#naming-the-second-hardest-problem-in-computer-science>#</a></h2><p>I feel like I should come up with a name for this, because it&rsquo;d make communicating about this easier for me and because this workflow <em>feels</em> like it would be useful to more than just me.</p><p>This is automation that makes a release when it detects by a version change in source code and publishes to PyPI and GitHub, with an auto-generated changelog.</p><p>For now, this is a problem for future me and depends on whether he decides that he needs to maintain another piece of reusable software.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>With a few too many &ldquo;critical&rdquo; (i.e. top 1% packages) on PyPI, including literally pip, I think an extra step to ensure that it&rsquo;s a bit harder to take-over things unilaterally seems reasonable to me.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>If you&rsquo;re an SBOM/SLSA person, this is also where I&rsquo;d like to include some sort of attestation/provenance information but there isn&rsquo;t any clear-enough documentation that I could find for how to do this. Please email me if you know of a solution (<code>mail@{this domain}</code>).&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://pradyunsg.me/tags/python-packaging/>Python packaging</a></li></ul><nav class=paginav><a class=prev href=https://pradyunsg.me/blog/2024/03/17/github-notifications-userstyles/><span class=title>« Newer</span><br><span>Making GitHub Notifications UI slightly nicer for bulk triage</span>
</a><a class=next href=https://pradyunsg.me/blog/2023/01/21/pdm-does-not-implement-pep-582/><span class=title>Older »</span><br><span>PDM does not implement PEP 582, at the time of writing</span></a></nav><div class=share-buttons-container><p class=share-buttons-label>Share on</p><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Choreographing a release process for my PyPI packages on mastodon" href="https://palant.info/fedishare.html#title=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages&url=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f&description=by Pradyun%20Gedam"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.58 13.913c-.29 1.469-2.592 3.121-5.238 3.396-1.379.184-2.737.368-4.185.276-2.368-.092-4.237-.551-4.237-.551.0.184.014.459.043.643.308 2.294 2.317 2.478 4.22 2.57 1.922.0 3.633-.46 3.633-.46l.079 1.653s-1.344.734-3.738.918c-1.32.091-2.96-.092-4.869-.551-4.14-1.102-4.853-5.507-4.961-10.005-.034-1.285-.013-2.57-.013-3.58.0-4.589 3-5.966 3-5.966 1.513-.734 4.11-1.01 6.808-1.01h.067c2.699.0 5.296.276 6.81 1.01.0.0 3 1.377 3 5.967.0.0.037 3.304-.419 5.69" stroke="currentcolor"/><path d="M17.832 8.633v5h-1.978V8.78c0-1.023-.43-1.542-1.29-1.542-.95.0-1.427.616-1.427 1.834v2.655H11.17V9.072c0-1.218-.476-1.834-1.427-1.834-.86.0-1.29.52-1.29 1.542v4.852H6.475V8.633c0-1.022.26-1.834.782-2.434.538-.6 1.243-.909 2.118-.909 1.012.0 1.779.39 2.286 1.169l.492.827.493-.827c.507-.78 1.274-1.169 2.286-1.169.875.0 1.58.308 2.118.909.522.6.782 1.412.782 2.434" fill="currentcolor" stroke="none"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Choreographing a release process for my PyPI packages on fediverse" href="https://palant.info/fedishare.html#title=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages&url=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f&description=by Pradyun%20Gedam"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 196.52 196.52" fill="currentcolor"><path d="M47.924 72.796a18.23 18.23.0 01-7.796 7.76l42.798 42.965 10.318-5.229-45.321-45.496zm56.452 56.67-10.318 5.229 21.686 21.771a18.23 18.23.0 017.797-7.761l-19.165-19.239zm49.518-39.669-24.229 12.279 1.786 11.427 27.415-13.894a18.23 18.23.0 01-4.972-9.812zm-38.295 19.408L58.31 138.238a18.23 18.23.0 014.973 9.813l54.103-27.419-1.786-11.428zM97.175 37.686 69.531 91.654l8.162 8.193 29.269-57.139a18.23 18.23.0 01-9.787-5.022zM62.341 105.69l-14.002 27.335a18.23 18.23.0 019.786 5.021l12.378-24.164-8.161-8.193zm-22.45-25.014a18.23 18.23.0 01-9.106 1.904l-1.76-.184 8.176 52.298a18.23 18.23.0 019.106-1.904l1.759.184-8.175-52.298zm23.435 67.634a18.23 18.23.0 01-1.732 10.863l52.289 8.391a18.23 18.23.0 011.732-10.863l-52.289-8.391zM159.05 99.8l-24.135 47.117a18.23 18.23.0 019.788 5.022l24.134-47.117a18.23 18.23.0 01-9.788-5.023zm-32.917-66.64a18.23 18.23.0 01-7.797 7.761l37.376 37.521a18.23 18.23.0 017.797-7.761L126.133 33.16zm-34.114-5.477L44.77 51.628a18.23 18.23.0 014.972 9.812L96.99 37.495a18.23 18.23.0 01-4.972-9.811zm26.23 13.281a18.23 18.23.0 01-9.256 1.98l-1.595-.167 4.185 26.8 11.42 1.832-4.754-30.445zm-4.233 44.193 9.896 63.363a18.23 18.23.0 0110.88-1.628l-9.355-59.903-11.42-1.832zm-64.24-23.516a18.23 18.23.0 01.201 3.729 18.23 18.23.0 01-1.894 7.139l26.821 4.308 5.272-10.294-30.398-4.882zm45.968 7.382-5.272 10.295 63.371 10.178a18.23 18.23.0 01-.184-3.63 18.23 18.23.0 011.945-7.23l-59.86-9.614z"/><g transform="matrix(.99852 .054393 -.054393 .99852 6.679 -32.496)" class="B"><circle cx="106.266" cy="51.536" r="16.571"/><circle cx="171.428" cy="110.193" r="16.571"/><circle cx="135.764" cy="190.277" r="16.571"/><circle cx="48.559" cy="181.114" r="16.571"/><circle cx="30.329" cy="95.367" r="16.571"/></g></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Choreographing a release process for my PyPI packages on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f&amp;title=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages&amp;summary=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages&amp;source=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Choreographing a release process for my PyPI packages on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f&title=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1"><path d="M24 11.779c0-1.459-1.192-2.645-2.657-2.645-.715.0-1.363.286-1.84.746-1.81-1.191-4.259-1.949-6.971-2.046l1.483-4.669 4.016.941-.006.058c0 1.193.975 2.163 2.174 2.163 1.198.0 2.172-.97 2.172-2.163S21.396 2 20.199 2c-.92.0-1.704.574-2.021 1.379l-4.329-1.015c-.189-.046-.381.063-.44.249L11.755 7.82c-2.838.034-5.409.798-7.3 2.025-.474-.438-1.103-.712-1.799-.712-1.465.0-2.656 1.187-2.656 2.646.0.97.533 1.811 1.317 2.271-.052.282-.086.567-.086.857C1.231 18.818 6.039 22 11.95 22s10.72-3.182 10.72-7.093c0-.274-.029-.544-.075-.81.832-.447 1.405-1.312 1.405-2.318zM6.776 13.595c0-.868.71-1.575 1.582-1.575s1.581.707 1.581 1.575-.709 1.574-1.581 1.574-1.582-.706-1.582-1.574zm9.061 4.669c-.797.793-2.048 1.179-3.824 1.179L12 19.44l-.013.003c-1.777.0-3.028-.386-3.824-1.179-.145-.144-.145-.379.0-.523.145-.145.381-.145.526.0.65.647 1.729.961 3.298.961l.013.003.013-.003c1.569.0 2.648-.315 3.298-.962.145-.145.381-.144.526.0.145.145.145.379.0.524zm-.189-3.095c-.872.0-1.581-.706-1.581-1.574s.709-1.575 1.581-1.575 1.581.707 1.581 1.575-.709 1.574-1.581 1.574z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Choreographing a release process for my PyPI packages on ycombinator" href="https://news.ycombinator.com/submitlink?t=Choreographing%20a%20release%20process%20for%20my%20PyPI%20packages&u=https%3a%2f%2fpradyunsg.me%2fblog%2f2024%2f01%2f27%2fpackage-release-workflow%2f"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></a></li></ul></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://pradyunsg.me/>Pradyun Gedam</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
with tweaks.</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>